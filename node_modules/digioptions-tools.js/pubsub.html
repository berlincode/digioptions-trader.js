<!DOCTYPE html>
<html dir="ltr" lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head> 
  <title>XMPP Pubsub Demo :: Publisher + Client</title> 
  <meta charset="utf-8" />
  <script type="text/javascript" src="node_modules/jquery/dist/jquery.min.js"></script>
  <script type="text/javascript" src="node_modules/strophe.js/strophe.js"></script> 
  <script type="text/javascript" src="./strophe.pubsub.js"></script> 
  <script type="text/javascript" src="./pubsub.js"></script>
  <link rel="stylesheet" href="css/styles.css" />
</head> 
<body> 
<div>
  <div id="connection_status">Connecting...</div>
  <p id="message"></p>
  <div id="content">
    <div>
      <h1>XMPP PubSub Demo Publisher + Client</h1>
      <p>Fill in the box below, and a message will be sent to all the clients connected.</p>
      <form>
        <fieldset>
          <ol>
            <li>
              <label for="message0">Enter a message to send:</label>
              <textarea id="message0" name="message0" rows="5" autofocus>{
"addr": "0x0000000000000000000000000000000000000000",
"blockExpires": 1234567,
"contractAddr": "000000000000000000000000000000000000000000",
"hash": "0x0000000000000000000000000000000000000000000000000000000000000000",
"optionID" :0,
"orderID" :4321098765,
"price" :0,
"r": "0x0000000000000000000000000000000000000000000000000000000000000000",
"s": "0x0000000000000000000000000000000000000000000000000000000000000000",
"size": 1000000000000000000,
"v": 27
}
    </textarea>
            </li>
            <li>
              <label for="message1">Enter a message to send:</label>
              <textarea id="message1" name="message1" rows="5">{
"addr": "0x0000000000000000000000000000000000000000",
"blockExpires": 1234567,
"contractAddr": "000000000000000000000000000000000000000000",
"hash": "0x0000000000000000000000000000000000000000000000000000000000000000",
"optionID" :0,
"orderID" :4321098765,
"price" :0,
"r": "0x0000000000000000000000000000000000000000000000000000000000000000",
"s": "0x0000000000000000000000000000000000000000000000000000000000000000",
"size": 1000000000000000000,
"v": 27
}
    </textarea>
            </li>
          </ol>
        </fieldset>
        <fieldset>
          <button id="publish" type="submit" style="display:none;">Publish the message</button>
          <span id="progress"></span>
        </fieldset>
      </form>
    </div>
  </div>
</div>
<script type="text/javascript">
//<![CDATA[

    var pubsub = new PubSub("wss", 'ropsten.xmpp.digioptions.com');

    pubsub.debug = true;

    $('#publish').click(function(event) {
        event.preventDefault();
        var data_array = [];
        try {
            data_array.push(JSON.parse($('#message0').val()));
        } catch (e) {}
        try {
            data_array.push(JSON.parse($('#message1').val()));
        } catch (e) {}
        if (data_array.length > 0)
            pubsub.publish(data_array);
    });

    pubsub.on_data = function(data){
        var i;
        for (i=0 ; i < data.length ; i++){
            var p = $("<p>").text(JSON.stringify(data[i]));
            $('#message').append(p);
        }
    };
    pubsub.feedback = function(msg, col, connection_ok){
        $('#connection_status').html(msg).css('color', col);
        if (connection_ok)
            $('#publish').fadeIn();
        else
            $('#publish').fadeOut();
    };

    pubsub.connect();

//]]>
</script>
</body> 
</html> 
